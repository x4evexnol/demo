<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SWE-Test Demo</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#0d1117;color:#c9d1d9;line-height:1.7}
header{text-align:center;padding:40px 20px 24px;border-bottom:1px solid #21262d}
header h1{color:#58a6ff;font-size:2.1em}
.sub{color:#8b949e;margin-top:6px;font-size:1.05em}
.wrap{max-width:1100px;margin:0 auto;padding:0 20px}
h2{color:#f0f6fc;margin:24px 0 14px;font-size:1.35em}
h3{color:#58a6ff;margin:18px 0 8px;font-size:1.1em}
h4{color:#8b949e;font-size:.82em;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}

/* Metric cards */
.mg{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin:20px 0 30px}
.mc{background:#161b22;border:1px solid #30363d;border-radius:10px;padding:18px;text-align:center;transition:all .3s;cursor:default}
.mc:hover{border-color:#58a6ff;box-shadow:0 0 12px rgba(88,166,255,.15)}
.mc.hl{border-color:#f78166;box-shadow:0 0 16px rgba(247,129,102,.25)}
.mc .icon{font-size:1.8em;margin-bottom:6px}
.mc h3{font-size:.95em;color:#f0f6fc;margin:0 0 4px}
.mc p{font-size:.8em;color:#8b949e;margin:0}

/* Tabs */
.tabs{display:flex;gap:2px;border-bottom:2px solid #21262d;margin:0 0 4px}
.tab{background:none;border:none;color:#8b949e;padding:12px 18px;cursor:pointer;font-size:.92em;border-bottom:2px solid transparent;transition:all .2s;margin-bottom:-2px}
.tab:hover{color:#c9d1d9}
.tab.on{color:#58a6ff;border-bottom-color:#58a6ff;font-weight:600}

/* Panels */
.panel{display:none;padding:20px 0 60px}
.panel.on{display:block}

/* Tags */
.tag{display:inline-block;padding:2px 10px;border-radius:12px;font-size:.78em;margin-right:4px}
.tag.blue{background:#1f6feb33;color:#58a6ff}
.tag.orange{background:#f7816633;color:#f78166}
.tag.green{background:#3fb95033;color:#3fb950}
.tag.red{background:#f8514933;color:#f85149}

/* Info boxes */
.igrid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin:14px 0}
.ibox{background:#161b22;border:1px solid #30363d;border-radius:8px;padding:14px}

/* Call stack */
.callstack{font-family:"Fira Code",monospace;font-size:.85em;background:#161b22;border:1px solid #30363d;border-radius:8px;padding:14px;margin:10px 0;overflow-x:auto}
.callstack .level{padding:2px 0;color:#8b949e}
.callstack .level.target{color:#f78166;font-weight:700}
.callstack .arrow{color:#484f58;margin:0 4px}

/* Metrics result table */
.mtable{width:100%;border-collapse:collapse;margin:14px 0}
.mtable th,.mtable td{padding:10px 14px;text-align:left;border-bottom:1px solid #21262d}
.mtable th{color:#8b949e;font-size:.82em;text-transform:uppercase;font-weight:600}
.mtable td{font-size:.92em}
.mtable .val{color:#58a6ff;font-weight:700;font-size:1.05em}
.mtable .val.green{color:#3fb950}
.mtable .val.orange{color:#f78166}

/* Trajectory */
.traj{margin:14px 0}
.tstep{border-left:2px solid #30363d;margin-left:12px;padding:0 0 0 18px;position:relative;margin-bottom:2px}
.tstep::before{content:"";position:absolute;left:-5px;top:12px;width:8px;height:8px;border-radius:50%;background:#30363d}
.tstep.think::before{background:#8957e5}
.tstep.cmd::before{background:#58a6ff}
.tstep.success::before{background:#3fb950}
.tstep.fail::before{background:#f85149}
.tstep.partial::before{background:#d29922}
.tstep-head{font-size:.82em;color:#8b949e;padding:6px 0 2px;cursor:pointer;user-select:none}
.tstep-head:hover{color:#c9d1d9}
.tstep-body{display:none;margin:4px 0 10px}
.tstep-body.open{display:block}
.tstep-label{font-size:.75em;padding:1px 8px;border-radius:8px;margin-left:6px}
.tstep-label.think{background:#8957e533;color:#8957e5}
.tstep-label.cmd{background:#58a6ff33;color:#58a6ff}
.tstep-label.result{background:#3fb95033;color:#3fb950}

pre{background:#0d1117;border:1px solid #30363d;border-radius:6px;padding:10px 12px;font-size:.82em;overflow-x:auto;margin:4px 0;font-family:"Fira Code",Consolas,monospace;color:#c9d1d9;white-space:pre-wrap;word-break:break-all}
pre .hl{color:#f78166;font-weight:700}
pre .ok{color:#3fb950;font-weight:700}

/* Reward chart */
.reward-chart{display:flex;align-items:end;gap:16px;height:160px;padding:20px;background:#161b22;border:1px solid #30363d;border-radius:8px;margin:14px 0}
.rbar{display:flex;flex-direction:column;align-items:center;flex:1}
.rbar-fill{width:40px;border-radius:4px 4px 0 0;transition:height .5s;position:relative}
.rbar-fill.r1{background:linear-gradient(180deg,#d29922,#d29922aa);height:50%}
.rbar-fill.r2{background:linear-gradient(180deg,#3fb950,#3fb950aa);height:100%}
.rbar-label{margin-top:8px;font-size:.78em;color:#8b949e;text-align:center}
.rbar-val{font-size:.85em;font-weight:700;margin-bottom:4px}
.rbar-val.partial{color:#d29922}
.rbar-val.success{color:#3fb950}

/* Collapsible prompt */
.prompt-toggle{background:#1f6feb33;border:1px solid #1f6feb55;color:#58a6ff;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:.9em;margin:14px 0 4px;display:inline-block;transition:all .2s}
.prompt-toggle:hover{background:#1f6feb55;color:#f0f6fc}
.prompt-content{display:none;margin:4px 0 14px}
.prompt-content.open{display:block}
.prompt-content pre{max-height:500px;overflow-y:auto;font-size:.8em;line-height:1.5;white-space:pre-wrap;word-break:break-all}

footer{text-align:center;padding:30px;border-top:1px solid #21262d;color:#484f58;font-size:.85em;margin-top:40px}

@media(max-width:768px){
  .mg{grid-template-columns:repeat(2,1fr)}
  .igrid{grid-template-columns:1fr}
  .tabs{flex-wrap:wrap}
}
</style>
</head>
<body>

<header>
  <h1>SWE-Test Demo</h1>
  <p class="sub">é¢å‘ä»£ç æ™ºèƒ½ä½“åŠ¨æ€è½¯ä»¶æµ‹è¯•èƒ½åŠ›çš„è¯„æµ‹åŸºå‡† â€” è¯„ä¼°æŒ‡æ ‡ç¤ºä¾‹</p>
</header>

<div class="wrap" id="app"></div>

<footer>SWE-Test Benchmark Demo &mdash; é¦™æ¸¯å¤§å­¦ç³»ç»Ÿä¸è½¯ä»¶å®‰å…¨å®éªŒå®¤</footer>

<script>
// ===== CASE DATA =====
const CASES = [
{
  id:"case1", title:"æ¡ˆä¾‹1ï¼šæ·±è°ƒç”¨é“¾è¯­ä¹‰æ¨ç†",
  tags:[{t:"libpng",c:"blue"},{t:"5å±‚è°ƒç”¨é“¾",c:"orange"},{t:"272s",c:"blue"}],
  program:"libpngï¼ˆPNGå›¾åƒè§£æåº“ï¼‰",
  branch:"png.c:1083 â€” png_colorspace_check_gamma",
  condition:"(colorspace->flags & PNG_COLORSPACE_HAVE_GAMMA) != 0",
  direction:"NOT TAKEN (FALSE) â†’ TAKEN (TRUE)",
  callstack:[
    {name:"LLVMFuzzerTestOneInput",file:"libpng_read_fuzzer.cc",target:false},
    {name:"png_read_info",file:"pngread.c",target:false},
    {name:"png_handle_gAMA",file:"pngrutil.c",target:false},
    {name:"png_colorspace_set_gamma",file:"png.c",target:false},
    {name:"png_colorspace_check_gamma",file:"png.c:1083",target:true}
  ],
  difficulty:"è¯¥åˆ†æ”¯è¦æ±‚è°ƒç”¨ png_colorspace_check_gamma æ—¶ï¼Œcolorspace->flags ä¸­å·²è®¾ç½® PNG_COLORSPACE_HAVE_GAMMA æ ‡å¿—ã€‚ä½†è¯¥å‡½æ•°ä» png_handle_gAMA è°ƒç”¨â€”â€”æ­£å¸¸æƒ…å†µä¸‹ gAMA chunk æ˜¯é¦–æ¬¡è®¾ç½® gammaï¼Œæ ‡å¿—å°šæœªè®¾ç½®ã€‚æ™ºèƒ½ä½“éœ€è¦ç†è§£ï¼šå¿…é¡»åœ¨ gAMA chunk ä¹‹å‰é€šè¿‡ sRGB chunk é¢„å…ˆè®¾ç½® gamma æ ‡å¿—ã€‚è¿™éœ€è¦è·¨å¤šå±‚è°ƒç”¨é“¾çš„çŠ¶æ€ä¼ é€’æ¨ç†ã€‚",
  metrics:{reach:"1",proximity:"N/A",time:"272ç§’",seed:"98 bytes, 1ä¸ªç§å­"},
  metricsHL:["mc-reach","mc-time"],
  promptFile:"prompt_000_medium.txt",
  prompt:`## Task

Generate a test input that inverts a branch condition from FALSE to TRUE.

## Hard Constraints
- DO NOT read/list/search/cat any files or directories under \`/out/\` (including subdirectories).
- Treat \`/out/\` binaries/scripts as black-box executables only.
- The only allowed interaction with \`/out/\` is executing the provided verification command.

### Branch Info
- File: /src/libpng/png.c:1083
- Function: png.c:png_colorspace_check_gamma
- Current: NOT TAKEN (FALSE) -> Target: TAKEN (TRUE)
- Trace: LLVMFuzzerTestOneInput -> OSS_FUZZ_png_read_info -> OSS_FUZZ_png_handle_gAMA -> OSS_FUZZ_png_colorspace_set_gamma -> png.c:png_colorspace_check_gamma

### Code
\`\`\`/src/libpng/png.c
extern "C" int LLVMFuzzerTestOneInput(const uint8_t* data, size_t size) {
  if (size < kPngHeaderSize) {
... (OMITTED CODE)
  png_read_info(png_handler.png_ptr, png_handler.info_ptr);
...
THEN REACHING png_handle_gAMA:
png_handle_gAMA(png_structrp png_ptr, png_inforp info_ptr, png_uint_32 length)
{
   png_fixed_point igamma;
   png_byte buf[4];
   ...
   png_colorspace_set_gamma(png_ptr, &png_ptr->colorspace, igamma);
...
THEN REACHING png_colorspace_set_gamma:
png_colorspace_set_gamma(png_const_structrp png_ptr,
    png_colorspacerp colorspace, png_fixed_point gAMA)
{
   ...
   else
   {
      if (png_colorspace_check_gamma(png_ptr, colorspace, gAMA,
...
THEN REACHING png_colorspace_check_gamma:
png_colorspace_check_gamma(png_const_structrp png_ptr,
    png_colorspacerp colorspace, png_fixed_point gAMA, int from)
{
   png_fixed_point gtest;

// THE BRANCH CONDITION IN THE FOLLOWING LINE IS NOT TAKEN (FALSE):
   if ((colorspace->flags & PNG_COLORSPACE_HAVE_GAMMA) != 0 &&
\`\`\`

### Call Stack
  - LLVMFuzzerTestOneInput at libpng_read_fuzzer.cc:101-208
  - OSS_FUZZ_png_read_info at pngread.c:91-262
  - OSS_FUZZ_png_handle_gAMA at pngrutil.c:1118-1152
  - OSS_FUZZ_png_colorspace_set_gamma at png.c:1113-1166
  - png.c:png_colorspace_check_gamma at png.c:1069-1111

### Verification
\`\`\`bash
python /out/verify_seed.py --question /tmp/question_000.json --seed /tmp/new_seed_000
\`\`\`
Expected output: "SUCCESS: Seed triggered the target branch! (reward=2)"`,
  trajectory:[
    {type:"think",text:"åˆ†æç›®æ ‡åˆ†æ”¯æ¡ä»¶ï¼š(colorspace->flags & PNG_COLORSPACE_HAVE_GAMMA) != 0ã€‚éœ€è¦åœ¨è°ƒç”¨ png_colorspace_check_gamma ä¹‹å‰ï¼Œcolorspace çš„ gamma æ ‡å¿—å·²ç»è¢«è®¾ç½®ã€‚"},
    {type:"think",text:"é˜…è¯» png_colorspace_set_gamma æºç ï¼Œå‘ç°å®ƒåœ¨è®¾ç½® gamma å‰ä¼šè°ƒç”¨ png_colorspace_check_gamma æ£€æŸ¥æ˜¯å¦å·²æœ‰ gammaã€‚å…³é”®ï¼šéœ€è¦è®© HAVE_GAMMA æ ‡å¿—åœ¨ gAMA chunk å¤„ç†å‰å°±å­˜åœ¨ã€‚"},
    {type:"cmd",cmd:"grep -n 'PNG_COLORSPACE_HAVE_GAMMA' /src/libpng/png.c | head -20",out:"1083:   if ((colorspace->flags & PNG_COLORSPACE_HAVE_GAMMA) != 0 &&\n1107:      colorspace->flags |= PNG_COLORSPACE_HAVE_GAMMA;\n...",exit:0},
    {type:"think",text:"å‘ç° sRGB chunk å¤„ç†å™¨ä¼šé€šè¿‡ png_colorspace_set_sRGB é—´æ¥è®¾ç½® gamma æ ‡å¿—ã€‚å¦‚æœ sRGB chunk å‡ºç°åœ¨ gAMA chunk ä¹‹å‰ï¼Œgamma æ ‡å¿—å°±ä¼šé¢„å…ˆè®¾ç½®ã€‚"},
    {type:"cmd",cmd:"# æ„é€  PNG: IHDR â†’ sRGB â†’ gAMA â†’ IDAT â†’ IEND\npython3 -c \"...æ„é€ æœ€å°PNG...\" > /tmp/new_seed_000",out:"(å†™å…¥ 98 å­—èŠ‚çš„ PNG æ–‡ä»¶)",exit:0},
    {type:"cmd",cmd:"python /out/verify_seed.py --question /tmp/question_000.json --seed /tmp/new_seed_000",out:"[coverage_reward] entered png_colorspace_check_gamma\n[coverage_reward] covered [1083, 7, 1083, 59]\n<span class='ok'>SUCCESS: Seed triggered the target branch! (reward=2)</span>",exit:0,reward:2}
  ]
},
{
  id:"case2", title:"æ¡ˆä¾‹2ï¼šå¿«é€Ÿç²¾å‡†è¾¹ç•Œæ„é€ ",
  tags:[{t:"libpng",c:"blue"},{t:"3å±‚è°ƒç”¨é“¾",c:"blue"},{t:"96s",c:"green"}],
  program:"libpngï¼ˆPNGå›¾åƒè§£æåº“ï¼‰",
  branch:"pngrutil.c:1978 â€” png_handle_bKGD",
  condition:"buf[0] >= info_ptr->num_palette",
  direction:"NOT TAKEN (FALSE) â†’ TAKEN (TRUE)",
  callstack:[
    {name:"LLVMFuzzerTestOneInput",file:"libpng_read_fuzzer.cc",target:false},
    {name:"png_read_info",file:"pngread.c",target:false},
    {name:"png_handle_bKGD",file:"pngrutil.c:1978",target:true}
  ],
  difficulty:"bKGD chunk æŒ‡å®š PNG èƒŒæ™¯è‰²ã€‚å½“ color_type=3ï¼ˆè°ƒè‰²æ¿æ¨¡å¼ï¼‰æ—¶ï¼ŒbKGD ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯è°ƒè‰²æ¿ç´¢å¼•ã€‚åˆ†æ”¯æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶…å‡ºè°ƒè‰²æ¿èŒƒå›´ã€‚æ™ºèƒ½ä½“éœ€è¦æ„é€ è°ƒè‰²æ¿æ¡ç›®æå°‘ä½† bKGD ç´¢å¼•å€¼å¾ˆå¤§çš„ PNGã€‚",
  metrics:{reach:"1",proximity:"N/A",time:"96ç§’",seed:"95 bytes, 1ä¸ªç§å­"},
  metricsHL:["mc-quality","mc-time"],
  promptFile:"prompt_010_medium.txt",
  prompt:`## Task

Generate a test input that inverts a branch condition from FALSE to TRUE.

## Hard Constraints
- DO NOT read/list/search/cat any files or directories under \`/out/\`.
- Treat \`/out/\` binaries/scripts as black-box executables only.

### Branch Info
- File: /src/libpng/pngrutil.c:1978
- Function: OSS_FUZZ_png_handle_bKGD
- Current: NOT TAKEN (FALSE) -> Target: TAKEN (TRUE)
- Trace: LLVMFuzzerTestOneInput -> OSS_FUZZ_png_read_info -> OSS_FUZZ_png_handle_bKGD

### Code
\`\`\`/src/libpng/pngrutil.c
extern "C" int LLVMFuzzerTestOneInput(const uint8_t* data, size_t size) {
  ...
  png_read_info(png_handler.png_ptr, png_handler.info_ptr);
...
THEN REACHING png_handle_bKGD:
png_handle_bKGD(png_structrp png_ptr, png_inforp info_ptr, png_uint_32 length)
{
   unsigned int truelen;
   png_byte buf[6];
   png_color_16 background;
   ...
   if (png_ptr->color_type == PNG_COLOR_TYPE_PALETTE)
      truelen = 1;
   ...
   png_crc_read(png_ptr, buf, truelen);
   ...
   if (png_ptr->color_type == PNG_COLOR_TYPE_PALETTE)
   {
      background.index = buf[0];
      if (info_ptr != NULL && info_ptr->num_palette != 0)
      {
// THE BRANCH CONDITION IN THE FOLLOWING LINE IS NOT TAKEN (FALSE):
         if (buf[0] >= info_ptr->num_palette)
\`\`\`

### Call Stack
  - LLVMFuzzerTestOneInput at libpng_read_fuzzer.cc:101-208
  - OSS_FUZZ_png_read_info at pngread.c:91-262
  - OSS_FUZZ_png_handle_bKGD at pngrutil.c:1919-2033

### Verification
\`\`\`bash
python /out/verify_seed.py --question /tmp/question_010.json --seed /tmp/new_seed_010
\`\`\`
Expected output: "SUCCESS: Seed triggered the target branch! (reward=2)"`,
  trajectory:[
    {type:"think",text:"åˆ†æåˆ†æ”¯æ¡ä»¶ï¼šbuf[0] >= info_ptr->num_paletteã€‚éœ€è¦ bKGD chunk çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ >= è°ƒè‰²æ¿æ¡ç›®æ•°ã€‚"},
    {type:"think",text:"ç­–ç•¥ï¼šæ„é€  color_type=3 çš„ PNGï¼ŒPLTE åªå« 1 ä¸ªæ¡ç›®ï¼ˆnum_palette=1ï¼‰ï¼ŒbKGD ç´¢å¼•è®¾ä¸º 255ã€‚255 >= 1 å³å¯è§¦å‘ã€‚"},
    {type:"cmd",cmd:"python3 -c \"...æ„é€ æœ€å°PNG...\" > /tmp/new_seed_010",out:"(å†™å…¥ 95 å­—èŠ‚çš„ PNG æ–‡ä»¶)",exit:0},
    {type:"cmd",cmd:"python /out/verify_seed.py --question /tmp/question_010.json --seed /tmp/new_seed_010",out:"[coverage_reward] entered png_handle_bKGD\n[coverage_reward] covered [1978, ...]\n<span class='ok'>SUCCESS: Seed triggered the target branch! (reward=2)</span>",exit:0,reward:2}
  ]
},
{
  id:"case3", title:"æ¡ˆä¾‹3ï¼šæ¸è¿›é€¼è¿‘ä¸è¿­ä»£æ¢ç´¢",
  tags:[{t:"QuickJS",c:"blue"},{t:"2å±‚è°ƒç”¨é“¾",c:"blue"},{t:"åˆ†æ”¯é€¼è¿‘åº¦",c:"orange"}],
  program:"QuickJSï¼ˆJavaScriptå¼•æ“ï¼‰",
  branch:"quickjs.c:33673 â€” resolve_labels",
  condition:"case OP_dropï¼ˆswitch-case åˆ†æ”¯ï¼‰",
  direction:"NOT TAKEN (FALSE) â†’ TAKEN (TRUE)",
  callstack:[
    {name:"LLVMFuzzerTestOneInput",file:"fuzz_eval.c",target:false},
    {name:"resolve_labels",file:"quickjs.c:33673",target:true}
  ],
  difficulty:"resolve_labels æ˜¯ QuickJS å­—èŠ‚ç ä¼˜åŒ–å™¨çš„æ ¸å¿ƒå‡½æ•°ï¼Œé€šè¿‡ switch-case éå†å­—èŠ‚ç æŒ‡ä»¤ã€‚ç›®æ ‡è¦æ±‚ç”Ÿæˆçš„ JS ä»£ç ç¼–è¯‘åäº§ç”Ÿ OP_drop æŒ‡ä»¤å¹¶åœ¨ä¼˜åŒ–è·¯å¾„ä¸­è¢«å¤„ç†ã€‚æ™ºèƒ½ä½“éœ€ç†è§£ JSæºç â†’å­—èŠ‚ç â†’resolve_labelsä¼˜åŒ– çš„ç¼–è¯‘ç®¡çº¿ã€‚",
  metrics:{reach:"1",proximity:"1.0 â†’ 1.0 â†’ 1.0 â†’ 2.0",time:"~300ç§’",seed:"28 bytes, 4ä¸ªç§å­"},
  metricsHL:["mc-proximity","mc-quality"],
  promptFile:"prompt_742_easy.txt",
  prompt:`## Task

Generate a test input that inverts a branch condition from FALSE to TRUE.

## Hard Constraints
- DO NOT read/list/search/cat any files or directories under \`/out/\`.
- Treat \`/out/\` binaries/scripts as black-box executables only.

### Branch Info
- File: /src/quickjs/quickjs.c:33673
- Function: quickjs.c:resolve_labels
- Current: NOT TAKEN (FALSE) -> Target: TAKEN (TRUE)
- Trace: LLVMFuzzerTestOneInput -> quickjs.c:resolve_labels

### Code
\`\`\`/src/quickjs/quickjs.c
int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) {
    if (size == 0) return 0;
    JSRuntime *rt = JS_NewRuntime();
    JSContext *ctx = JS_NewContext(rt);
    ...
    JSValue val = JS_Eval(ctx, (const char *)null_terminated_data,
                          size, "<none>", JS_EVAL_TYPE_GLOBAL);
    ...
}
...
THEN REACHING resolve_labels:
static __exception int resolve_labels(JSContext *ctx, JSFunctionDef *s)
{
    ...
    for (pos = 0; pos < bc_len; pos = pos_next) {
        int val;
        op = bc_buf[pos];
        len = opcode_info[op].size;
        pos_next = pos + len;
        switch(op) {
        case OP_label: ...
        case OP_call:
        case OP_call_method:
            { /* detect and transform tail calls */ ... }
        case OP_return: ...
        case OP_goto: ...
// THE BRANCH CONDITION IN THE FOLLOWING LINE IS NOT TAKEN (FALSE):
        case OP_drop:
\`\`\`

### Reference Seed
\`\`\`
function assert(actual, expected, message) {}
var f = function f() {};
assert(f.prototype.constructor, f, "prototype");
\`\`\`

### Verification
\`\`\`bash
python /out/verify_seed.py --question /tmp/question_742.json --seed /tmp/new_seed_742
\`\`\`
Expected output: "SUCCESS: Seed triggered the target branch! (reward=2)"`,
  rewardHistory:[
    {seed:"1;",reward:1,label:"è¿›å…¥å‡½æ•°ï¼Œæœªè¦†ç›–åˆ†æ”¯"},
    {seed:"1;2;",reward:1,label:"è¿›å…¥å‡½æ•°ï¼Œæœªè¦†ç›–åˆ†æ”¯"},
    {seed:"for(0;0;0){}",reward:1,label:"è¿›å…¥å‡½æ•°ï¼Œæœªè¦†ç›–åˆ†æ”¯"},
    {seed:"function f(){}\\nfor(f();0;0){}",reward:2,label:"æˆåŠŸåˆ°è¾¾ç›®æ ‡åˆ†æ”¯ï¼"}
  ],
  trajectory:[
    {type:"think",text:"åˆ†æç›®æ ‡ï¼šcase OP_drop åœ¨ resolve_labels çš„ switch ä¸­ã€‚éœ€è¦ç”ŸæˆåŒ…å« OP_drop å­—èŠ‚ç çš„ JS ä»£ç ã€‚OP_drop é€šå¸¸åœ¨è¡¨è¾¾å¼è¯­å¥ä¸¢å¼ƒè¿”å›å€¼æ—¶ç”Ÿæˆã€‚"},
    {type:"cmd",cmd:"cat > /tmp/new_seed_742 << 'EOF'\n1;\nEOF",out:"",exit:0},
    {type:"cmd",cmd:"python /out/verify_seed.py --question /tmp/question_742.json --seed /tmp/new_seed_742",
     out:"[coverage_reward] entered resolve_labels\n[coverage_reward] near resolve_labels [33673, 8, 33673, 20]\n<span class='hl'>PARTIAL: Entered target function but branch not covered (reward=1)</span>",exit:1,reward:1},
    {type:"think",text:"reward=1ï¼šå·²è¿›å…¥ resolve_labels ä½† case OP_drop æœªå‘½ä¸­ã€‚å°è¯•å¤šä¸ªè¡¨è¾¾å¼è¯­å¥ã€‚"},
    {type:"cmd",cmd:"cat > /tmp/new_seed_742 << 'EOF'\n1;2;\nEOF",out:"",exit:0},
    {type:"cmd",cmd:"python /out/verify_seed.py --question /tmp/question_742.json --seed /tmp/new_seed_742",
     out:"[coverage_reward] entered resolve_labels\n[coverage_reward] near resolve_labels [33673, 8, 33673, 20]\n<span class='hl'>PARTIAL: Entered target function but branch not covered (reward=1)</span>",exit:1,reward:1},
    {type:"think",text:"ä»ç„¶ reward=1ã€‚ç®€å•è¡¨è¾¾å¼è¯­å¥çš„ OP_drop å¯èƒ½åœ¨ç¼–è¯‘æ—©æœŸè¢«ä¼˜åŒ–æ‰ï¼Œæœªè¿›å…¥ resolve_labelsã€‚å°è¯• for å¾ªç¯ã€‚"},
    {type:"cmd",cmd:"cat > /tmp/new_seed_742 << 'EOF'\nfor(0;0;0){}\nEOF",out:"",exit:0},
    {type:"cmd",cmd:"python /out/verify_seed.py --question /tmp/question_742.json --seed /tmp/new_seed_742",
     out:"[coverage_reward] entered resolve_labels\n[coverage_reward] near resolve_labels [33673, 8, 33673, 20]\n<span class='hl'>PARTIAL: Entered target function but branch not covered (reward=1)</span>",exit:1,reward:1},
    {type:"think",text:"ç¬¬3æ¬¡å¤±è´¥ã€‚å¼€å§‹æ·±å…¥é˜…è¯» resolve_labels æºç ï¼Œåˆ†æ OP_drop åœ¨ä¼˜åŒ–è·¯å¾„ä¸­çš„å…·ä½“è§¦å‘æ¡ä»¶ã€‚"},
    {type:"cmd",cmd:"nl -ba /src/quickjs/quickjs.c | sed -n '33430,33505p'",
     out:"33430  case OP_call:\n33431  case OP_call_method:\n...\n33460  /* detect and transform tail calls */\n...\n33490  case OP_drop:\n33491      ...",exit:0},
    {type:"think",text:"å…³é”®å‘ç°ï¼šåœ¨ resolve_labels ä¸­ï¼ŒOP_drop ç´§è·Ÿåœ¨ OP_call/OP_call_method çš„å¤„ç†ä¹‹åã€‚éœ€è¦æ„é€ \"å‡½æ•°è°ƒç”¨ç»“æœè¢«ä¸¢å¼ƒ\"çš„æ¨¡å¼â€”â€”å³å‡½æ•°è°ƒç”¨åè·Ÿ OP_dropã€‚"},
    {type:"cmd",cmd:"cat > /tmp/new_seed_742 << 'EOF'\nfunction f(){}\nfor(f();0;0){}\nEOF",out:"",exit:0},
    {type:"cmd",cmd:"python /out/verify_seed.py --question /tmp/question_742.json --seed /tmp/new_seed_742",
     out:"[coverage_reward] entered resolve_labels\n[coverage_reward] covered resolve_labels [33673, 8, 33673, 20]\n<span class='ok'>SUCCESS: Seed triggered the target branch! (reward=2)</span>",exit:0,reward:2}
  ]
}
];

// ===== RENDER FUNCTIONS =====
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

function renderMetrics(){
  return `<section>
  <h2>è¯„ä¼°æŒ‡æ ‡ä½“ç³»</h2>
  <div class="mg">
    <div class="mc" id="mc-reach"><div class="icon">ğŸ¯</div><h3>ç›®æ ‡åˆ°è¾¾ç‡</h3><p>æ˜¯å¦æˆåŠŸåˆ°è¾¾æŒ‡å®šç›®æ ‡åˆ†æ”¯ï¼ˆ0/1ï¼‰</p></div>
    <div class="mc" id="mc-proximity"><div class="icon">ğŸ“</div><h3>åˆ†æ”¯é€¼è¿‘åº¦</h3><p>æœªåˆ°è¾¾æ—¶ï¼Œè¡¡é‡æ‰§è¡Œè·¯å¾„ä¸ç›®æ ‡çš„æ¥è¿‘ç¨‹åº¦</p></div>
    <div class="mc" id="mc-time"><div class="icon">â±ï¸</div><h3>ä»»åŠ¡å®Œæˆè€—æ—¶</h3><p>ä»ä»»åŠ¡ä¸‹å‘åˆ°å®Œæˆçš„ç«¯åˆ°ç«¯è€—æ—¶</p></div>
    <div class="mc" id="mc-quality"><div class="icon">ğŸ§¬</div><h3>ç§å­è´¨é‡</h3><p>ç§å­æ•°é‡ã€å¤§å°ã€æ˜¯å¦è§¦å‘é¢å¤–å´©æºƒ</p></div>
  </div></section>`;
}

function renderTabs(){
  return `<div class="tabs">${CASES.map((c,i)=>
    `<button class="tab${i===0?' on':''}" data-idx="${i}">${c.title}</button>`
  ).join('')}</div>`;
}

function renderCallstack(cs){
  return `<div class="callstack">${cs.map((c,i)=>
    `<div class="level${c.target?' target':''}" style="padding-left:${i*20}px">${i>0?'<span class="arrow">â†’ </span>':''}${c.name} <span style="color:#484f58;font-size:.85em">(${c.file})</span>${c.target?' â† ç›®æ ‡åˆ†æ”¯':''}</div>`
  ).join('')}</div>`;
}

function renderTrajectory(traj){
  let h='<div class="traj">';
  let stepNum=0;
  traj.forEach((s,i)=>{
    if(s.type==='think'){
      h+=`<div class="tstep think">
        <div class="tstep-head" onclick="this.nextElementSibling.classList.toggle('open')">
          ğŸ’­ æ™ºèƒ½ä½“æ¨ç† <span class="tstep-label think">Thinking</span></div>
        <div class="tstep-body"><p style="color:#d2a8ff;font-size:.88em">${esc(s.text)}</p></div></div>`;
    } else if(s.type==='cmd'){
      stepNum++;
      let cls='cmd';
      if(s.reward===2) cls='success';
      else if(s.reward===1) cls='partial';
      else if(s.exit!==0 && s.reward===undefined) cls='fail';
      let rewardTag='';
      if(s.reward===2) rewardTag=' <span class="tag green">reward=2 âœ“</span>';
      else if(s.reward===1) rewardTag=' <span class="tag orange">reward=1</span>';
      h+=`<div class="tstep ${cls}">
        <div class="tstep-head" onclick="this.nextElementSibling.classList.toggle('open')">
          âš¡ Step ${stepNum}: æ‰§è¡Œå‘½ä»¤ <span class="tstep-label cmd">Command</span>${rewardTag}</div>
        <div class="tstep-body${s.reward!==undefined?' open':''}">
          <pre>$ ${esc(s.cmd)}</pre>
          ${s.out?`<pre>${s.out}</pre>`:''}
        </div></div>`;
    }
  });
  h+='</div>';
  return h;
}

function renderRewardChart(rh){
  if(!rh) return '';
  let h='<h3>Reward å˜åŒ–è¿‡ç¨‹</h3><p style="color:#8b949e;font-size:.88em;margin:6px 0 10px">æ™ºèƒ½ä½“æ¯æ¬¡æ„é€ ä¸åŒçš„æµ‹è¯•è¾“å…¥ï¼ˆç§å­ï¼‰ï¼Œæäº¤ç»™ç›®æ ‡ç¨‹åºæ‰§è¡Œï¼Œæ ¹æ®è¿”å›çš„ reward å€¼åˆ¤æ–­æ˜¯å¦æ¥è¿‘ç›®æ ‡åˆ†æ”¯ã€‚</p><div class="reward-chart">';
  rh.forEach((r,i)=>{
    let cls=r.reward>=2?'r2':'r1';
    let vcls=r.reward>=2?'success':'partial';
    let pct=r.reward>=2?'100%':'50%';
    h+=`<div class="rbar">
      <div class="rbar-val ${vcls}">reward=${r.reward}</div>
      <div class="rbar-fill ${cls}" style="height:${pct}"></div>
      <div class="rbar-label">#${i+1}<br><span style="color:#58a6ff;font-size:.7em">ç§å­å†…å®¹:</span><br><code style="font-size:.75em">${esc(r.seed)}</code><br><span style="font-size:.75em">${r.label}</span></div>
    </div>`;
  });
  h+='</div>';
  return h;
}
// renderMetricsTable
function renderMetricsTable(m){
  return `<table class="mtable">
  <tr><th>æŒ‡æ ‡</th><th>å€¼</th><th>è¯´æ˜</th></tr>
  <tr><td>ğŸ¯ ç›®æ ‡åˆ°è¾¾ç‡</td><td class="val green">${m.reach}</td><td>æˆåŠŸåˆ°è¾¾ç›®æ ‡åˆ†æ”¯</td></tr>
  <tr><td>ğŸ“ åˆ†æ”¯é€¼è¿‘åº¦</td><td class="val${m.proximity!=='N/A'?' orange':''}">${m.proximity}</td><td>${m.proximity==='N/A'?'å·²åˆ°è¾¾ï¼Œæ— éœ€è®¡ç®—':'å±•ç¤ºæ¸è¿›é€¼è¿‘è¿‡ç¨‹'}</td></tr>
  <tr><td>â±ï¸ ä»»åŠ¡å®Œæˆè€—æ—¶</td><td class="val">${m.time}</td><td>ç«¯åˆ°ç«¯è€—æ—¶</td></tr>
  <tr><td>ğŸ§¬ ç§å­è´¨é‡</td><td class="val">${m.seed}</td><td>ç”Ÿæˆç§å­çš„æ•°é‡ä¸å¤§å°</td></tr>
  </table>`;
}

function renderPrompt(c){
  let id='prompt-'+c.id;
  return `<h3>ä»»åŠ¡ Prompt</h3>
    <div class="prompt-toggle" onclick="document.getElementById('${id}').classList.toggle('open')">
      ğŸ“„ ${c.promptFile}ï¼ˆç‚¹å‡»å±•å¼€/æ”¶èµ·ï¼‰
    </div>
    <div class="prompt-content" id="${id}"><pre>${esc(c.prompt)}</pre></div>`;
}

function renderCase(c){
  let h=`<div><h2>${c.title}</h2>
    <div style="margin-bottom:16px">${c.tags.map(t=>`<span class="tag ${t.c}">${t.t}</span>`).join('')}</div>
    <div class="igrid">
      <div class="ibox"><h4>ç›®æ ‡ç¨‹åº</h4><p>${c.program}</p></div>
      <div class="ibox"><h4>ç›®æ ‡åˆ†æ”¯</h4><p><code>${c.branch}</code></p></div>
      <div class="ibox"><h4>åˆ†æ”¯æ¡ä»¶</h4><p><code>${esc(c.condition)}</code></p></div>
      <div class="ibox"><h4>æ–¹å‘</h4><p>${c.direction}</p></div>
    </div>`;
  h+=`<h3>è°ƒç”¨é“¾</h3>${renderCallstack(c.callstack)}`;
  h+=`<h3>éš¾ç‚¹åˆ†æ</h3><div class="ibox"><p>${c.difficulty}</p></div>`;
  if(c.prompt) h+=renderPrompt(c);
  if(c.rewardHistory) h+=renderRewardChart(c.rewardHistory);
  h+=`<h3>æ™ºèƒ½ä½“æ‰§è¡Œè½¨è¿¹</h3>${renderTrajectory(c.trajectory)}`;
  h+=`<h3>è¯„ä¼°æŒ‡æ ‡ç»“æœ</h3>${renderMetricsTable(c.metrics)}</div>`;
  return h;
}

// ===== MAIN APP =====
let curIdx=0;
function switchCase(idx){
  curIdx=idx;
  document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('on',i===idx));
  document.querySelectorAll('.panel').forEach((p,i)=>p.classList.toggle('on',i===idx));
  // highlight relevant metric cards
  document.querySelectorAll('.mc').forEach(m=>m.classList.remove('hl'));
  (CASES[idx].metricsHL||[]).forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.classList.add('hl');
  });
}

function init(){
  const app=document.getElementById('app');
  let h=renderMetrics();
  h+=renderTabs();
  CASES.forEach((c,i)=>{
    h+=`<div class="panel${i===0?' on':''}">${renderCase(c)}</div>`;
  });
  app.innerHTML=h;
  document.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click',()=>switchCase(+t.dataset.idx));
  });
  switchCase(0);
}
init();
</script>
</body>
</html>
